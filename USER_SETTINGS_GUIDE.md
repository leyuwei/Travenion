# 用户信息更改功能使用指南

## 功能概述

新增的用户信息更改功能允许用户：
- 更新个人信息（昵称、邮箱、头像）
- 修改登录密码
- 查看当前用户信息

## API接口文档

### 1. 获取当前用户信息
- **接口**: `GET /travenion/api/auth/me`
- **认证**: 需要Bearer Token
- **响应**: 返回用户详细信息（包括昵称、头像等）

### 2. 更新用户信息
- **接口**: `PUT /travenion/api/auth/me`
- **认证**: 需要Bearer Token
- **请求体**:
  ```json
  {
    "nickname": "新昵称",
    "email": "new@example.com",
    "avatar": "https://example.com/avatar.jpg"
  }
  ```
- **说明**: 所有字段都是可选的，只更新提供的字段

### 3. 修改密码
- **接口**: `PUT /travenion/api/auth/password`
- **认证**: 需要Bearer Token
- **请求体**:
  ```json
  {
    "currentPassword": "当前密码",
    "newPassword": "新密码"
  }
  ```

## 前端页面

### 设置页面
- **路径**: `/travenion/settings.html`
- **功能**:
  - 显示当前用户信息
  - 更新个人信息表单
  - 修改密码表单
  - 实时验证和错误提示

### 导航链接
- 在 `plans.html` 和 `plan.html` 页面的导航栏中添加了"设置"链接
- 用户可以方便地访问设置页面

## 使用步骤

1. **登录系统**
   - 访问 `http://localhost:8311/travenion/`
   - 使用现有账户登录

2. **访问设置页面**
   - 点击导航栏中的"设置"按钮
   - 或直接访问 `http://localhost:8311/travenion/settings.html`

3. **更新个人信息**
   - 在"更新个人信息"部分填写要修改的字段
   - 点击"更新信息"按钮
   - 系统会显示更新结果

4. **修改密码**
   - 在"修改密码"部分输入当前密码和新密码
   - 确认新密码
   - 点击"修改密码"按钮

## 安全特性

- **密码验证**: 修改密码时需要验证当前密码
- **邮箱唯一性**: 更新邮箱时检查是否已被其他用户使用
- **输入验证**: 前端和后端都进行输入验证
- **JWT认证**: 所有操作都需要有效的JWT令牌

## 错误处理

- **401 未授权**: Token无效或已过期
- **409 冲突**: 邮箱已被使用
- **400 请求错误**: 参数验证失败
- **500 服务器错误**: 数据库操作失败

## 数据库字段

用户表包含以下字段：
- `username`: 用户名（不可修改）
- `email`: 邮箱地址
- `password_hash`: 密码哈希
- `nickname`: 昵称
- `avatar`: 头像URL
- `is_active`: 账户状态
- `created_at`: 创建时间
- `updated_at`: 更新时间

## 注意事项

1. 用户名不支持修改（保持系统稳定性）
2. 密码长度至少6位
3. 邮箱格式需要有效
4. 头像支持URL格式
5. 昵称最大长度50字符

## 问题修复记录

### 已修复的问题：
1. **checkAuth函数未定义错误** - 在settings.js中添加了checkAuth和getToken函数
2. **CSS样式加载失败** - 在settings.html中添加了正确的base href设置
3. **401未授权错误** - 修复了认证检查逻辑
4. **shared.js样式错误** - 移除了不必要的shared.js引用
5. **导航栏结构不一致** - 统一了导航栏样式和结构

### 修复内容：
- 添加了`/travenion/`的base href
- 添加了字体和图标引用
- 实现了正确的JWT token验证
- 添加了用户欢迎信息显示
- 统一了退出登录功能

## 测试建议

1. 测试正常的信息更新流程
2. 测试密码修改功能
3. 测试邮箱重复的情况
4. 测试无效输入的处理
5. 测试未登录状态的访问控制
6. 测试页面样式和导航功能